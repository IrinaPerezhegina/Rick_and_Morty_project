import{r as t,H as S,z as L,j as i}from"./vendor-CwXzf0uu.js";import{$ as b,a as j,L as m,C as F}from"./index-DA_JmFwS.js";import{F as E,a as k,I}from"./InfiniteScrollWidget-Cf7YMRps.js";import"./logo-black-60ZNf1du.js";import"./logo-CKJZryAy.js";import"./loader-D2m_05EX.js";const D=async e=>{try{const a=await b.get("character/",{params:{...N(e)}}),{info:r,results:c}=a.data,{next:g}=r,u=c.map(s=>s.status==="unknown"?{...s,status:"Unknown"}:s);return{next:!!g,results:u}}catch(a){throw console.error("Ошибка при запросе:",a),a}};function N(e){const a={};return e.filterStatus&&(a.status=e.filterStatus),e.genderValue&&(a.gender=e.genderValue),e.searchValue&&(a.name=e.searchValue),e.speciesValue&&(a.species=e.speciesValue),e.page&&(a.page=e.page),a}function P(e,a){const r=t.useRef(null);return t.useCallback(c=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{e(c)},a)},[e,a])}function T(){const[e,a]=t.useState({searchValue:"",filterStatus:"",speciesValue:"",genderValue:"",page:1}),r=t.useCallback(n=>{a(o=>({...o,searchValue:n,page:1}))},[]),c=P(r,1e3),g=t.useCallback(n=>{a(o=>({...o,filterStatus:n,page:1}))},[]),u=t.useCallback(n=>{a(o=>({...o,speciesValue:n,page:1}))},[]),s=t.useCallback(n=>{a(o=>({...o,genderValue:n,page:1}))},[]),d=t.useCallback(()=>{a(n=>({...n,page:n.page+1}))},[]);return{filter:e,onTurnNextPage:d,debounceFetchData:c,onChangeStatus:g,onChangeSpecies:u,onChangeGender:s}}function w(e){const[a,r]=t.useState(!0),[c,g]=t.useState(!0),[u,s]=t.useState([]),[d,n]=t.useState(!0),o=a&&e.page===1,C=!a&&c&&u.length>0,V=a&&e.page>1;let p=!1;t.useEffect(()=>{p||(r(!0),D(e).then(({next:l,results:f})=>{g(l),e.page===1&&s(f),e.page>1&&s(h=>[...h,...f])}).catch(l=>{l.status===S.NotFound?s([]):(s([]),L.error("Data upload error"))}).finally(()=>{d&&n(!1),r(!1)}),p=!0)},[e]);const x=t.useCallback(l=>{s(f=>f.map(h=>h.id===l.id?{...h,name:l.name,status:l.status,location:{name:l.location,url:h.location.url}}:h))},[]);return{data:u,isLoading:o,isTargetElementVisible:C,isSmallLoaderVisible:V,isLoadingInitial:d,onEditCharacterCard:x}}const H=t.memo(()=>{const{filter:e,onChangeGender:a,debounceFetchData:r,onChangeSpecies:c,onChangeStatus:g,onTurnNextPage:u}=T(),{data:s,isLoading:d,isTargetElementVisible:n,isSmallLoaderVisible:o,isLoadingInitial:C,onEditCharacterCard:V}=w(e);return i.jsxs(i.Fragment,{children:[i.jsx(j,{}),C?i.jsx(m,{variant:"bigLoader",text:"Loading characters..."}):i.jsxs(i.Fragment,{children:[i.jsx(E,{genderValue:e.genderValue,searchValue:e.searchValue,statusValue:e.filterStatus,speciesValue:e.speciesValue,onChangeGender:a,onChangeSpecies:c,onChangeStatus:g,onChangeSearch:r}),i.jsxs(F,{isLoading:d,children:[s.length>0?s.map(p=>i.jsx(k,{onEditCharacter:V,character:p},p.id)):i.jsx("span",{children:"No data..."}),i.jsx(m,{isLoading:o,variant:"smallLoader"}),n&&i.jsx(I,{onScrollEnd:u})]})]})]})});export{H as default};
