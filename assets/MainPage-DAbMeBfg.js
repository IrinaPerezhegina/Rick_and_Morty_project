import{r as n,H as L,z as b,j as r}from"./vendor-CwXzf0uu.js";import{$ as j,a as F,L as S,C as E}from"./index-zcIeFVpQ.js";import{F as k,a as I,I as N}from"./InfiniteScrollWidget-DT--euzc.js";import"./logo-black-60ZNf1du.js";import"./logo-CKJZryAy.js";import"./loader-D2m_05EX.js";const P=async e=>{try{const a=await j.get("character/",{params:{...T(e)}}),{info:o,results:u}=a.data,{next:g}=o,c=u.map(s=>s.status==="unknown"?{...s,status:"Unknown"}:s);return{next:!!g,results:c}}catch(a){throw console.error("Ошибка при запросе:",a),a}};function T(e){const a={};return e.filterStatus&&(a.status=e.filterStatus),e.genderValue&&(a.gender=e.genderValue),e.searchValue&&(a.name=e.searchValue),e.speciesValue&&(a.species=e.speciesValue),e.page&&(a.page=e.page),a}function D(){const[e,a]=n.useState({searchValue:"",filterStatus:"",speciesValue:"",genderValue:"",page:1}),o=n.useCallback(t=>{a(i=>({...i,searchValue:t,page:1}))},[]),u=n.useCallback(t=>{a(i=>({...i,filterStatus:t,page:1}))},[]),g=n.useCallback(t=>{a(i=>({...i,speciesValue:t,page:1}))},[]),c=n.useCallback(t=>{a(i=>({...i,genderValue:t,page:1}))},[]),s=n.useCallback(()=>{a(t=>({...t,page:t.page+1}))},[]);return{filter:e,onTurnNextPage:s,debounceFetchData:o,onChangeStatus:u,onChangeSpecies:g,onChangeGender:c}}function w(e){const[a,o]=n.useState(!0),[u,g]=n.useState(!0),[c,s]=n.useState([]),[t,i]=n.useState(!0),[,h]=n.useTransition(),C=a&&e.page===1,V=!a&&u&&c.length>0,p=a&&e.page>1;let x=!1;n.useEffect(()=>{x||(o(!0),P(e).then(({next:l,results:f})=>{g(l),e.page===1&&h(()=>s(f)),e.page>1&&h(()=>s(d=>[...d,...f]))}).catch(l=>{l.status===L.NotFound?s([]):(s([]),b.error("Data upload error"))}).finally(()=>{t&&i(!1),o(!1)}),x=!0)},[e]);const m=n.useCallback(l=>{s(f=>f.map(d=>d.id===l.id?{...d,name:l.name,status:l.status,location:{name:l.location,url:d.location.url}}:d))},[]);return{data:c,isLoading:C,isTargetElementVisible:V,isSmallLoaderVisible:p,isLoadingInitial:t,onEditCharacterCard:m}}const R=n.memo(()=>{const{filter:e,onChangeGender:a,debounceFetchData:o,onChangeSpecies:u,onChangeStatus:g,onTurnNextPage:c}=D(),{data:s,isLoading:t,isTargetElementVisible:i,isSmallLoaderVisible:h,isLoadingInitial:C,onEditCharacterCard:V}=w(e);return r.jsxs(r.Fragment,{children:[r.jsx(F,{}),C?r.jsx(S,{variant:"bigLoader",text:"Loading characters..."}):r.jsxs(r.Fragment,{children:[r.jsx(k,{genderValue:e.genderValue,searchValue:e.searchValue,statusValue:e.filterStatus,speciesValue:e.speciesValue,onChangeGender:a,onChangeSpecies:u,onChangeStatus:g,onChangeSearch:o}),r.jsxs(E,{isLoading:t,children:[s.length>0?s.map(p=>r.jsx(I,{onEditCharacter:V,character:p},p.id)):r.jsx("span",{children:"No data..."}),r.jsx(S,{isLoading:h,variant:"smallLoader"}),i&&r.jsx(N,{onScrollEnd:c})]})]})]})});export{R as default};
